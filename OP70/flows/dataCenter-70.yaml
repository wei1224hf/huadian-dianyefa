- id: 20ecc5cb793b2ee6
  type: tab
  label: dataCenter-70
  disabled: false
  info: ''
  env: []
- id: 1acc8dbee09d3a3d
  type: modbus-read
  z: 20ecc5cb793b2ee6
  name: 运行螺丝刀-上
  topic: ''
  showStatusActivities: false
  logIOActivities: false
  showErrors: false
  showWarnings: true
  unitid: ''
  dataType: HoldingRegister
  adr: '23'
  quantity: '1'
  rate: '200'
  rateUnit: ms
  delayOnStart: false
  startDelayTime: ''
  server: 6f8d38c417897cab
  useIOFile: false
  ioFile: ''
  useIOForPayload: false
  emptyMsgOnFail: false
  x: 530
  'y': 60
  wires:
    - - 328a0480c1e91dc5
    - []
- id: 328a0480c1e91dc5
  type: rbe
  z: 20ecc5cb793b2ee6
  name: ''
  func: rbe
  gap: ''
  start: ''
  inout: out
  septopics: true
  property: 'payload[0]'
  topi: topic
  x: 710
  'y': 60
  wires:
    - - 7593c411e9e110b0
- id: 7593c411e9e110b0
  type: change
  z: 20ecc5cb793b2ee6
  name: ''
  rules:
    - t: set
      p: IO_70.AI.screw_up_run
      pt: global
      to: 'payload[0]'
      tot: msg
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 940
  'y': 60
  wires:
    - []
- id: 8e3d2c2be7237f08
  type: modbus-read
  z: 20ecc5cb793b2ee6
  name: 运行螺丝刀-下
  topic: ''
  showStatusActivities: false
  logIOActivities: false
  showErrors: false
  showWarnings: true
  unitid: ''
  dataType: HoldingRegister
  adr: '27'
  quantity: '1'
  rate: '200'
  rateUnit: ms
  delayOnStart: false
  startDelayTime: ''
  server: 6f8d38c417897cab
  useIOFile: false
  ioFile: ''
  useIOForPayload: false
  emptyMsgOnFail: false
  x: 530
  'y': 120
  wires:
    - - 000aada5386288d8
    - []
- id: 000aada5386288d8
  type: rbe
  z: 20ecc5cb793b2ee6
  name: ''
  func: rbe
  gap: ''
  start: ''
  inout: out
  septopics: true
  property: 'payload[0]'
  topi: topic
  x: 710
  'y': 120
  wires:
    - - 651de794b90e7309
- id: 651de794b90e7309
  type: change
  z: 20ecc5cb793b2ee6
  name: ''
  rules:
    - t: set
      p: IO_70.AI.screw_down_run
      pt: global
      to: 'payload[0]'
      tot: msg
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 950
  'y': 120
  wires:
    - []
- id: c92c3030a8b66da1
  type: modbus-read
  z: 20ecc5cb793b2ee6
  name: 复位螺丝刀-上
  topic: ''
  showStatusActivities: false
  logIOActivities: false
  showErrors: false
  showWarnings: true
  unitid: '1'
  dataType: HoldingRegister
  adr: '22'
  quantity: '1'
  rate: '200'
  rateUnit: ms
  delayOnStart: false
  startDelayTime: ''
  server: 6f8d38c417897cab
  useIOFile: false
  ioFile: ''
  useIOForPayload: false
  emptyMsgOnFail: false
  x: 530
  'y': 180
  wires:
    - - 705805d726349233
    - []
- id: 705805d726349233
  type: rbe
  z: 20ecc5cb793b2ee6
  name: ''
  func: rbe
  gap: ''
  start: ''
  inout: out
  septopics: true
  property: 'payload[0]'
  topi: topic
  x: 710
  'y': 180
  wires:
    - - c6638bf24edd0e7d
- id: c6638bf24edd0e7d
  type: change
  z: 20ecc5cb793b2ee6
  name: ''
  rules:
    - t: set
      p: IO_70.AI.screw_up_reset
      pt: global
      to: 'payload[0]'
      tot: msg
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 950
  'y': 180
  wires:
    - []
- id: 09a7fbb2dab275b7
  type: modbus-read
  z: 20ecc5cb793b2ee6
  name: 复位螺丝刀-下
  topic: ''
  showStatusActivities: false
  logIOActivities: false
  showErrors: false
  showWarnings: true
  unitid: '1'
  dataType: HoldingRegister
  adr: '26'
  quantity: '1'
  rate: '200'
  rateUnit: ms
  delayOnStart: false
  startDelayTime: ''
  server: 6f8d38c417897cab
  useIOFile: false
  ioFile: ''
  useIOForPayload: false
  emptyMsgOnFail: false
  x: 530
  'y': 240
  wires:
    - - 6d724b3d526b1261
    - []
- id: 6d724b3d526b1261
  type: rbe
  z: 20ecc5cb793b2ee6
  name: ''
  func: rbe
  gap: ''
  start: ''
  inout: out
  septopics: true
  property: 'payload[0]'
  topi: topic
  x: 710
  'y': 240
  wires:
    - - 8f8bbb46edbe8661
- id: 8f8bbb46edbe8661
  type: change
  z: 20ecc5cb793b2ee6
  name: ''
  rules:
    - t: set
      p: IO_70.AI.screw_down_reset
      pt: global
      to: 'payload[0]'
      tot: msg
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 960
  'y': 240
  wires:
    - []
- id: 6438a2b608a115ee
  type: inject
  z: 20ecc5cb793b2ee6
  name: OP70数据初始化
  props:
    - p: payload
    - p: topic
      vt: str
  repeat: ''
  crontab: ''
  once: true
  onceDelay: '1'
  topic: ''
  payload: ''
  payloadType: date
  x: 210
  'y': 20
  wires:
    - - 9c22b32ef6374ba0
- id: 1897a224540a3006
  type: function
  z: 20ecc5cb793b2ee6
  name: IO初始化
  func: |-
    var IO_70 = {
        DO:{},
        DI:{
    emergency:0,
    start:0,
    stop:0,
    manual:0,
    auto:0,
    R_zhendong:0,
    R_zhendong_shuchu:0,
    R_baitai_jiajin:0,
    R_baitai_songkai:0,
    L_zhendong:0,
    L_zhendong_shuchu:0,
    L_jiazhua_jiajin:0,
    L_jiazhua_songkai:0,
    L_baitai_jiajin:0,
    L_baitai_songkai:0,
    shang_jiazhua_jiajin:0,
    shang_jiazhua_songkai:0,
    shang_tuigan_shenzhan:0,
    shang_tuigan_shousuo:0,
    shang_youliao:0,
    xia_jiazhua_jiajin:0,
    xia_jiazhua_songkai:0,
    xia_tuigan_shenzhan:0,
    xia_tuigan_shousuo:0,
    xia_youliao:0,
    L_tuigan_shenzhan:0,
    L_tuigan_shousuo:0,
    L_youliao:0,
    R_jiazhua_jiajin:0,
    R_jiazhua_songkai:0,
    R_tuigan_shenzhan:0,
    R_tuigan_shousuo:0,
    R_youliao:0,
    zhong_jiazhua_jiajin:0,
    zhong_jiazhua_songkai:0,
    zhong_youliao:0,
        },
        AI:{//node-red收到来自控制器的逻辑变量
            Home : 0,
            error : 0,
            status : 0,
            screw_up_reset : 0,
            screw_up_run : 0,
            screw_up_clockwise : 0,
            screw_up_pause : 0,
            screw_down_reset : 0,
            screw_down_run : 0,
            screw_down_clockwise : 0,
            screw_down_pause : 0,
            screw_up_mode : 0,
            screw_down_mode : 0,

        },
        AO:{//node-red要发送下去的逻辑变量
            work_object : 0,
            LCS_command : 0,
            screw_status : 0,
            LCS_speed : 0,

            index_screw_front : 0,
            index_screw_side : 0,
        },    
        AI_LCS:{
            request: 0,
            speed: 0,
        },
        AO_LCS:{
            response: 0,
        },  
    };

    global.set("IO_70",IO_70);

    return msg;
  outputs: 1
  timeout: 0
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 660
  'y': 20
  wires:
    - - e0fd6c2d76fabf9f
- id: e0fd6c2d76fabf9f
  type: function
  z: 20ecc5cb793b2ee6
  name: 物料-视觉-工单 初始化
  func: >

    var ErrorMap_70 = [
        "视觉通信故障",
        "螺丝刀通信故障",
        "伺服1故障",
        "伺服2故障",
        "伺服3故障",
        "伺服4故障",   
        "伺服5故障",
        "伺服6故障",
        "伺服7故障",
        ];
        
    global.set("StationTask_70",{
        BillCode: "-",
        ProductCode: "-",
        ProductName:"-",
        ProcessDetail: [{
            ProcessCode: "OP70",
            ProcessName: "-",
            EquipmentCode: "OP70",
            ProgramNumer: 1,
            Num: 0,
            completed: 0,
            MaterialDetails: [
                {
                    MaterialCode: "M5x20",
                    MaterialName: "M5x20内六角螺丝",
                    Num: 0,
                    consumption: 15,
                    remain: 0,
                    used: 0,
                }
          
            ]
        }]
    });


    const t = (new Date()).toISOString();

    global.set("Request_70",{
        StartTime:t,
        EndTime:t,
        RequestID:"-",
        RequestID_:"-",
        barcode: "",
    });


    global.set("ErrorMap_70", ErrorMap_70);

    global.set("LCS", "http://192.168.110.200:9006/openApiUbiquitous/");

    global.set("front_torque", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0]);

    global.set("back_torque", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0]);


    return msg;
  outputs: 1
  timeout: 0
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 880
  'y': 20
  wires:
    - []
- id: 9c22b32ef6374ba0
  type: function
  z: 20ecc5cb793b2ee6
  name: 定义变量名
  func: |-
    global.set("ns",{
        LCS_start:1,
        LCS_stop:2,
        LCS_pause:3,
        LCS_resume:4,
        LCS_run:5,


    });
    return msg;
  outputs: 1
  timeout: 0
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 490
  'y': 20
  wires:
    - - 1897a224540a3006
- id: 95af2d98241dd940
  type: modbus-server
  z: 20ecc5cb793b2ee6
  name: OP70
  logEnabled: false
  hostname: 0.0.0.0
  serverPort: '10070'
  responseDelay: 100
  delayUnit: ms
  coilsBufferSize: 10000
  holdingBufferSize: 10000
  inputBufferSize: 10000
  discreteBufferSize: 10000
  showErrors: false
  x: 150
  'y': 180
  wires:
    - []
    - []
    - []
    - []
    - []
- id: 5ee1d30aa6411ac8
  type: modbus-read
  z: 20ecc5cb793b2ee6
  d: true
  name: 设备端读取DI
  topic: ''
  showStatusActivities: false
  logIOActivities: false
  showErrors: false
  showWarnings: true
  unitid: '1'
  dataType: HoldingRegister
  adr: '50'
  quantity: '36'
  rate: '200'
  rateUnit: ms
  delayOnStart: false
  startDelayTime: ''
  server: 6f8d38c417897cab
  useIOFile: false
  ioFile: ''
  useIOForPayload: false
  emptyMsgOnFail: false
  x: 530
  'y': 320
  wires:
    - - 1a93879bf9c4a070
      - 6fee81982cda4096
    - []
- id: 1a93879bf9c4a070
  type: function
  z: 20ecc5cb793b2ee6
  name: 写入本地内存
  func: |-
    var DI_Names = [
        "emergency",
        "start",
        "stop",
        "manual",
        "auto",
        "R_zhendong",
        "R_zhendong_shuchu",
        "R_baitai_jiajin",
        "R_baitai_songkai",
        "L_zhendong",
        "L_zhendong_shuchu",
        "L_jiazhua_jiajin",
        "L_jiazhua_songkai",
        "L_baitai_jiajin",
        "L_baitai_songkai",
        "shang_jiazhua_jiajin",
        "shang_jiazhua_songkai",
        "shang_tuigan_shenzhan",
        "shang_tuigan_shousuo",
        "shang_youliao",
        "xia_jiazhua_jiajin",
        "xia_jiazhua_songkai",
        "xia_tuigan_shenzhan",
        "xia_tuigan_shousuo",
        "xia_youliao",
        "L_tuigan_shenzhan",
        "L_tuigan_shousuo",
        "L_youliao",
        "R_jiazhua_jiajin",
        "R_jiazhua_songkai",
        "R_tuigan_shenzhan",
        "R_tuigan_shousuo",
        "R_youliao",
        "zhong_jiazhua_jiajin",
        "zhong_jiazhua_songkai",
        "zhong_youliao",
    ];

    var IO = global.get("IO_70");
    const data = msg.payload;
    for (var i = 0; i < DI_Names.length; i++) {
        if (DI_Names[i] != '-') {
            IO.DI[DI_Names[i]] = data[i];
        }
    }

    return msg;
  outputs: 1
  timeout: 0
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 780
  'y': 320
  wires:
    - []
- id: 6fee81982cda4096
  type: modbus-write
  z: 20ecc5cb793b2ee6
  name: DI信号同步
  showStatusActivities: false
  showErrors: false
  showWarnings: true
  unitid: '1'
  dataType: MHoldingRegisters
  adr: '50'
  quantity: '36'
  server: f45c8577844ced46
  emptyMsgOnFail: false
  keepMsgProperties: false
  delayOnStart: false
  startDelayTime: ''
  x: 770
  'y': 360
  wires:
    - []
    - []
- id: b4526aec31e1ec04
  type: modbus-read
  z: 20ecc5cb793b2ee6
  name: LCS
  topic: '1'
  showStatusActivities: false
  logIOActivities: false
  showErrors: false
  showWarnings: true
  unitid: '1'
  dataType: HoldingRegister
  adr: '4070'
  quantity: '1'
  rate: '200'
  rateUnit: ms
  delayOnStart: false
  startDelayTime: ''
  server: f45c8577844ced46
  useIOFile: false
  ioFile: ''
  useIOForPayload: false
  emptyMsgOnFail: false
  x: 490
  'y': 540
  wires:
    - - 72212c896ab92a16
    - []
- id: f8c0e00c1337aab3
  type: modbus-read
  z: 20ecc5cb793b2ee6
  name: 设备端读取status
  topic: ''
  showStatusActivities: false
  logIOActivities: false
  showErrors: false
  showWarnings: true
  unitid: '1'
  dataType: HoldingRegister
  adr: '21'
  quantity: '1'
  rate: '200'
  rateUnit: ms
  delayOnStart: false
  startDelayTime: ''
  server: 6f8d38c417897cab
  useIOFile: false
  ioFile: ''
  useIOForPayload: false
  emptyMsgOnFail: false
  x: 540
  'y': 400
  wires:
    - - 69635627929e33bc
    - []
- id: 69635627929e33bc
  type: change
  z: 20ecc5cb793b2ee6
  name: ''
  rules:
    - t: set
      p: IO_70.AI.status
      pt: global
      to: 'payload[0]'
      tot: msg
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 760
  'y': 400
  wires:
    - []
- id: 72212c896ab92a16
  type: modbus-write
  z: 20ecc5cb793b2ee6
  name: ''
  showStatusActivities: false
  showErrors: false
  showWarnings: true
  unitid: '1'
  dataType: MHoldingRegisters
  adr: '4'
  quantity: '1'
  server: 6f8d38c417897cab
  emptyMsgOnFail: false
  keepMsgProperties: false
  delayOnStart: false
  startDelayTime: ''
  x: 760
  'y': 560
  wires:
    - []
    - []
- id: 5216724c59c530e4
  type: inject
  z: 20ecc5cb793b2ee6
  name: ''
  props:
    - p: payload
  repeat: ''
  crontab: ''
  once: false
  onceDelay: 0.1
  topic: ''
  payload: '-'
  payloadType: str
  x: 410
  'y': 620
  wires:
    - - d4284e2180130236
- id: d4284e2180130236
  type: change
  z: 20ecc5cb793b2ee6
  name: ''
  rules:
    - t: set
      p: Request_70.RequestID
      pt: global
      to: '-'
      tot: str
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 640
  'y': 660
  wires:
    - []
- id: def7b74dd73c77b9
  type: http in
  z: 20ecc5cb793b2ee6
  name: ''
  url: /70/data
  method: get
  upload: false
  swaggerDoc: ''
  x: 230
  'y': 720
  wires:
    - - 9bc3906f868c0782
- id: 1e57f8f96e834f72
  type: http response
  z: 20ecc5cb793b2ee6
  name: ''
  statusCode: ''
  headers: {}
  x: 690
  'y': 720
  wires: []
- id: 9bc3906f868c0782
  type: function
  z: 20ecc5cb793b2ee6
  name: function 30
  func: |-
    const p = msg.payload.key;
    var arr = p.split(".");
    const obj = global.get(arr[0]);
    eval("var "+arr[0]+" = obj;");
    console.debug(1);
    eval("msg.payload = "+p+";");
    console.debug(2);
    return msg;
  outputs: 1
  timeout: 0
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 450
  'y': 720
  wires:
    - - 1e57f8f96e834f72
- id: 36a89f6b5c0bc662
  type: http in
  z: 20ecc5cb793b2ee6
  name: ''
  url: /70/RequestID
  method: get
  upload: false
  swaggerDoc: ''
  x: 610
  'y': 620
  wires:
    - - 45e29054f0b73dce
- id: 45e29054f0b73dce
  type: change
  z: 20ecc5cb793b2ee6
  name: ''
  rules:
    - t: set
      p: payload
      pt: msg
      to: '-'
      tot: str
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 735
  'y': 620
  wires:
    - - d4284e2180130236
      - b61d1fa5ad54fbbb
  l: false
- id: b61d1fa5ad54fbbb
  type: http response
  z: 20ecc5cb793b2ee6
  name: ''
  statusCode: ''
  headers: {}
  x: 850
  'y': 620
  wires: []
